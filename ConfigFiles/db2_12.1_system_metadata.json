{
  "provider": "DB2",
  "version": "12.1",
  "collected_at": "2025-11-20T10:00:00Z",
  "description": "DB2 v12.1 System Catalog Metadata",
  "system_tables": [
    {
      "schema": "SYSCAT",
      "table_name": "TABLES",
      "description": "Catalog information for tables and views",
      "key_columns": ["TABSCHEMA", "TABNAME"],
      "important_columns": ["TYPE", "OWNER", "CREATED", "ALTER_TIME", "DATACAPTURE", "TBSPACE", "CARD", "NPAGES", "REMARKS"],
      "column_data_types": {
        "TABSCHEMA": "VARCHAR(128)",
        "TABNAME": "VARCHAR(128)",
        "TYPE": "CHAR(1)",
        "OWNER": "VARCHAR(128)",
        "CREATED": "TIMESTAMP",
        "ALTER_TIME": "TIMESTAMP",
        "DATACAPTURE": "CHAR(1)",
        "TBSPACE": "VARCHAR(128)",
        "CARD": "BIGINT",
        "NPAGES": "INTEGER",
        "REMARKS": "VARCHAR(254)"
      },
      "notes": "TYPE: T=Table, V=View, S=Materialized View, A=Alias. CHAR columns require TRIM()."
    },
    {
      "schema": "SYSCAT",
      "table_name": "COLUMNS",
      "description": "Column information for all tables",
      "key_columns": ["TABSCHEMA", "TABNAME", "COLNAME"],
      "important_columns": ["COLNO", "TYPENAME", "LENGTH", "SCALE", "NULLS", "DEFAULT", "REMARKS"],
      "column_data_types": {
        "TABSCHEMA": "VARCHAR(128)",
        "TABNAME": "VARCHAR(128)",
        "COLNAME": "VARCHAR(128)",
        "COLNO": "SMALLINT",
        "TYPENAME": "VARCHAR(18)",
        "LENGTH": "INTEGER",
        "SCALE": "SMALLINT",
        "NULLS": "CHAR(1)",
        "DEFAULT": "VARCHAR(254)",
        "REMARKS": "VARCHAR(254)"
      },
      "notes": "NULLS: Y=Nullable, N=Not Null. COLNO is 0-based. CHAR columns require TRIM()."
    },
    {
      "schema": "SYSCAT",
      "table_name": "VIEWS",
      "description": "View-specific information",
      "key_columns": ["VIEWSCHEMA", "VIEWNAME"],
      "important_columns": ["DEFINER", "TEXT"],
      "notes": "CRITICAL: SYSCAT.VIEWS does NOT contain REMARKS or ALTER_TIME. Must join with SYSCAT.TABLES to get these fields. CHAR columns require TRIM()."
    },
    {
      "schema": "SYSCAT",
      "table_name": "INDEXES",
      "description": "Index information",
      "key_columns": ["INDSCHEMA", "INDNAME"],
      "important_columns": ["TABSCHEMA", "TABNAME", "UNIQUERULE", "INDEXTYPE", "COLNAMES", "CREATE_TIME", "REMARKS"]
    },
    {
      "schema": "SYSCAT",
      "table_name": "PACKAGES",
      "description": "DB2 package information",
      "key_columns": ["PKGSCHEMA", "PKGNAME"],
      "important_columns": ["BOUNDBY", "ISOLATION", "LASTUSED", "VALID"],
      "notes": "CHAR columns require TRIM()."
    },
    {
      "schema": "SYSCAT",
      "table_name": "STATEMENTS",
      "description": "SQL statements in packages",
      "key_columns": ["PKGSCHEMA", "PKGNAME", "STMTNO", "SECTNO", "SEQNO"],
      "important_columns": ["TEXT"],
      "notes": "CRITICAL: Must join to SYSCAT.PACKAGES on both PKGSCHEMA and PKGNAME. Order by STMTNO, SECTNO, SEQNO."
    },
    {
      "schema": "SYSCAT",
      "table_name": "REFERENCES",
      "description": "Foreign key relationships",
      "key_columns": ["CONSTNAME", "TABSCHEMA", "TABNAME"],
      "important_columns": ["REFTABSCHEMA", "REFTABNAME", "FK_COLNAMES", "PK_COLNAMES"]
    }
  ],
  "relationships": [
    {
      "relationship_id": "tables_to_columns",
      "from_table": "SYSCAT.TABLES",
      "to_table": "SYSCAT.COLUMNS",
      "join_condition": "TABLES.TABSCHEMA = COLUMNS.TABSCHEMA AND TABLES.TABNAME = COLUMNS.TABNAME",
      "cardinality": "1:N",
      "description": "Each table has multiple columns"
    },
    {
      "relationship_id": "tables_to_indexes",
      "from_table": "SYSCAT.TABLES",
      "to_table": "SYSCAT.INDEXES",
      "join_condition": "TABLES.TABSCHEMA = INDEXES.TABSCHEMA AND TABLES.TABNAME = INDEXES.TABNAME",
      "cardinality": "1:N",
      "description": "Each table can have multiple indexes"
    },
    {
      "relationship_id": "tables_to_views",
      "from_table": "SYSCAT.TABLES",
      "to_table": "SYSCAT.VIEWS",
      "join_condition": "TABLES.TABSCHEMA = VIEWS.VIEWSCHEMA AND TABLES.TABNAME = VIEWS.VIEWNAME",
      "cardinality": "1:1",
      "description": "CRITICAL: Always join TABLES and VIEWS for complete view information. REMARKS comes from TABLES, not VIEWS."
    },
    {
      "relationship_id": "packages_to_statements",
      "from_table": "SYSCAT.PACKAGES",
      "to_table": "SYSCAT.STATEMENTS",
      "join_condition": "PACKAGES.PKGSCHEMA = STATEMENTS.PKGSCHEMA AND PACKAGES.PKGNAME = STATEMENTS.PKGNAME",
      "cardinality": "1:N",
      "description": "Each package contains multiple SQL statements"
    },
    {
      "relationship_id": "tables_to_references_fk",
      "from_table": "SYSCAT.TABLES",
      "to_table": "SYSCAT.REFERENCES",
      "join_condition": "TABLES.TABSCHEMA = REFERENCES.TABSCHEMA AND TABLES.TABNAME = REFERENCES.TABNAME",
      "cardinality": "1:N",
      "description": "Foreign keys FROM this table (referencing other tables)"
    },
    {
      "relationship_id": "tables_to_references_pk",
      "from_table": "SYSCAT.TABLES",
      "to_table": "SYSCAT.REFERENCES",
      "join_condition": "TABLES.TABSCHEMA = REFERENCES.REFTABSCHEMA AND TABLES.TABNAME = REFERENCES.REFTABNAME",
      "cardinality": "1:N",
      "description": "Foreign keys TO this table (referenced by other tables)"
    }
  ],
  "query_patterns": {
    "how_to_find_foreign_keys": {
      "description": "Find all foreign keys for a table",
      "example_sql": "SELECT * FROM SYSCAT.REFERENCES WHERE TABSCHEMA = ? AND TABNAME = ?",
      "notes": "Use FK_COLNAMES and PK_COLNAMES for column lists"
    },
    "how_to_check_if_fk_is_indexed": {
      "description": "Check if foreign key columns have matching index for performance",
      "example_sql": "SELECT R.*, I.INDNAME FROM SYSCAT.REFERENCES R LEFT JOIN SYSCAT.INDEXES I ON R.TABSCHEMA = I.TABSCHEMA AND R.TABNAME = I.TABNAME WHERE R.TABSCHEMA = ?",
      "notes": "Match index COLNAMES with FK_COLNAMES to verify coverage"
    },
    "how_to_determine_packages_using_table": {
      "description": "Find which packages depend on a specific table",
      "example_sql": "SELECT DISTINCT P.* FROM SYSCAT.PACKAGES P JOIN SYSCAT.PACKAGEDEP D ON P.PKGSCHEMA = D.PKGSCHEMA AND P.PKGNAME = D.PKGNAME WHERE D.BSCHEMA = ? AND D.BNAME = ? AND D.BTYPE = 'T'",
      "notes": "BTYPE = 'T' for tables, 'V' for views, 'F' for functions"
    }
  }
}

